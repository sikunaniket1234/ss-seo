<div class="audit-page">
  <div class="header-actions flex justify-between items-center mb-8">
    <div>
      <a routerLink="/" class="back-link">‚Üê Back to Dashboard</a>
      <h2 class="page-title mt-2">SEO Audit Report</h2>
    </div>
    <div class="flex gap-4">
      <button class="btn btn-outline" (click)="runAudit()" [disabled]="loading()">
        {{ loading() ? 'Analyzing...' : 'Re-run Audit' }}
      </button>
      <button class="btn btn-outline" (click)="exportReport()" [disabled]="!getCurrentReport()">
        Download JSON
      </button>
      <button class="btn btn-outline" (click)="printReport()" [disabled]="!getCurrentReport()">
        üìÑ Export PDF
      </button>
      <button class="btn btn-primary" (click)="applyPatch()" [disabled]="patching() || !getCurrentReport()?.suggestedTags">
        {{ patching() ? 'Applying...' : 'Apply AI Suggestions' }}
      </button>
    </div>
  </div>

  @if (loading()) {
    <div class="loading-state glass-card text-center">
      <div class="loader"></div>
      <p>Crawling site files and computing deep SEO intelligence...</p>
    </div>
  } @else if (siteReport()) {
    <div class="audit-grid">
      <!-- Site Summary -->
      <div class="summary-card glass-card full-width">
        <div class="flex justify-between items-center">
            <div>
                <h3>Project Overview: Site-Wide Health</h3>
                <p class="text-muted">{{ siteReport()!.pages.length }} pages analyzed</p>
            </div>
            <div class="flex gap-4">
                <button class="btn btn-outline btn-sm" (click)="generateTechnical()" [disabled]="generatingTechnical()">
                    {{ generatingTechnical() ? 'Generating...' : 'üõ†Ô∏è Gen Sitemap/Robots' }}
                </button>
            </div>
        </div>
      </div>

      <!-- Page Selector -->
      <div class="page-selector glass-card">
        <h3>Pages</h3>
        <div class="page-list mt-4">
            @for (page of siteReport()!.pages; track page.url; let i = $index) {
                <div class="page-item" [class.active]="selectedPageIndex() === i" (click)="selectedPageIndex.set(i); selectedVariationIndex.set(0)">
                    <span class="page-name">{{ page.url }}</span>
                    <span class="page-score" [class]="getScoreClass(page.overallScore)">{{ page.overallScore }}%</span>
                </div>
            }
        </div>
      </div>

      <!-- Details for Selected Page -->
      @if (getCurrentReport(); as pageReport) {
        <div class="details-pane">
            <div class="flex gap-4 mb-6">
                <!-- Overview -->
                <div class="overview-card glass-card flex-1">
                    <div class="score-circle" [class]="getScoreClass(pageReport.overallScore)">
                        <span class="score-value">{{ pageReport.overallScore }}%</span>
                        <span class="score-label">Page Health</span>
                    </div>
                    <div class="scores-list mt-6">
                        <div class="score-item">
                            <span>Readability</span>
                            <div class="progress-bar"><div class="fill" [style.width.%]="pageReport.readabilityScore || 0" [class]="getScoreClass(pageReport.readabilityScore || 0)"></div></div>
                            <span class="score-num">{{ pageReport.readabilityScore || 0 }}%</span>
                        </div>
                        <div class="score-item">
                            <span>Meta Quality</span>
                            <div class="progress-bar"><div class="fill" [style.width.%]="pageReport.scores.meta" [class]="getScoreClass(pageReport.scores.meta)"></div></div>
                        </div>
                    </div>
                </div>

                <!-- Recommendations -->
                <div class="recommendations-card glass-card flex-1">
                    <h3>Actionable Tips</h3>
                    <ul class="recs-list">
                    @for (rec of pageReport.recommendations; track rec) {
                        <li class="rec-item">
                        <span class="icon">üí°</span>
                        {{ rec }}
                        </li>
                    }
                    @if (pageReport.brokenLinks && pageReport.brokenLinks.length > 0) {
                        <li class="rec-item error">
                            <span class="icon">üîó</span>
                            Found {{ pageReport.brokenLinks.length }} suspicious/broken links.
                        </li>
                    }
                    </ul>
                </div>
            </div>

            <!-- AI Suggestions vs Current -->
            <div class="suggestions-card glass-card">
                <div class="flex justify-between items-center mb-4">
                    <h3>AI Optimized Meta Tags</h3>
                    <div class="flex gap-2">
                        <button class="btn btn-outline btn-xs btn-refresh" (click)="refreshSuggestions()" [disabled]="refreshingAI()">
                            {{ refreshingAI() ? '...' : 'üîÑ Refresh' }}
                        </button>
                        <span class="badge badge-ai">Safe Patch Ready</span>
                    </div>
                </div>
                <!-- Variations Selector -->
                @if (pageReport.suggestedTags?.variations) {
                    <div class="variation-tabs mb-6 flex gap-2">
                        @for (v of pageReport.suggestedTags?.variations; track v.id; let vi = $index) {
                            <button class="v-tab px-4 py-2 rounded-lg text-sm transition" 
                                    [class]="v.id"
                                    [class.active]="selectedVariationIndex() === vi" 
                                    (click)="selectedVariationIndex.set(vi)">
                                <div class="flex items-center gap-2">
                                    <span>{{ v.id === 'benefit' ? 'üöÄ' : v.id === 'informative' ? 'üí°' : 'üèÜ' }}</span>
                                    <div class="font-bold">{{ v.strategy }}</div>
                                </div>
                                <div class="text-xs opacity-70">{{ v.score }}% strength</div>
                            </button>
                        }
                    </div>
                }

                <div class="diff-table">
                    <div class="diff-row header">
                        <div class="col">Tag</div>
                        <div class="col">Current</div>
                        <div class="col">Suggested ({{ pageReport.suggestedTags?.variations?.[selectedVariationIndex()]?.strategy || 'Auto' }})</div>
                    </div>
                    <div class="diff-row">
                        <div class="col label">Title</div>
                        <div class="col current">{{ pageReport.data.title || 'Empty' }}</div>
                        <div class="col suggested">
                            {{ pageReport.suggestedTags?.variations?.[selectedVariationIndex()]?.title || pageReport.suggestedTags?.title }}
                        </div>
                    </div>
                    <div class="diff-row">
                        <div class="col label">Description</div>
                        <div class="col current">{{ pageReport.data.description || 'Empty' }}</div>
                        <div class="col suggested">
                            {{ pageReport.suggestedTags?.variations?.[selectedVariationIndex()]?.description || pageReport.suggestedTags?.description }}
                        </div>
                    </div>
                </div>

                <button class="btn btn-primary mt-6 w-full" (click)="applyPatch()" [disabled]="patching()">
                    {{ patching() ? 'Applying...' : 'üöÄ Apply Selected AI Variation' }}
                </button>
            </div>

            <!-- SERP Preview Simulator -->
            <div class="serp-preview-card glass-card mt-6">
                <div class="flex justify-between items-center mb-6">
                    <div class="flex items-center gap-2">
                        <h3>Visual SERP Simulator</h3>
                        <span class="badge badge-outline text-[10px]">Real-time Preview</span>
                    </div>
                    <div class="preview-toggles flex p-1 bg-black/20 rounded-lg">
                        <button class="px-3 py-1 rounded-md text-xs transition" 
                                [class.active]="serpMode() === 'desktop'" 
                                (click)="serpMode.set('desktop')">üñ•Ô∏è Desktop</button>
                        <button class="px-3 py-1 rounded-md text-xs transition" 
                                [class.active]="serpMode() === 'mobile'" 
                                (click)="serpMode.set('mobile')">üì± Mobile</button>
                    </div>
                </div>

                <div class="google-container" [class.mobile-view]="serpMode() === 'mobile'">
                    <div class="google-result">
                        <div class="result-site-info">
                            <span class="site-icon">üåê</span>
                            <div class="site-path">
                                <span class="site-name">{{ site()?.url || 'yoursite.com' }}</span>
                                <span class="site-url">{{ pageReport.url }}</span>
                            </div>
                        </div>
                        <h4 class="result-title">
                            {{ pageReport.suggestedTags?.variations?.[selectedVariationIndex()]?.title || pageReport.suggestedTags?.title }}
                        </h4>
                        <p class="result-description">
                            {{ pageReport.suggestedTags?.variations?.[selectedVariationIndex()]?.description || pageReport.suggestedTags?.description }}
                        </p>
                    </div>
                </div>
            </div>

            <!-- Rank Tracker Section -->
            <div class="rank-tracker-card glass-card mt-6">
                <div class="flex justify-between items-center mb-6">
                    <div class="flex items-center gap-2">
                        <h3>Keyword Rank Tracker</h3>
                        <span class="badge badge-ai">Live SERP Check</span>
                    </div>
                </div>

                @if (!site()?.url && !editingUrl()) {
                    <div class="alert bg-orange-500/10 border border-orange-500/20 p-4 rounded-xl mb-6">
                        <div class="flex items-center gap-3">
                            <span>‚ö†Ô∏è</span>
                            <div>
                                <div class="font-bold text-orange-400">Live URL Missing</div>
                                <div class="text-sm opacity-80">We need a live URL to check rankings on Google.</div>
                                <button class="btn btn-xs mt-2" (click)="editingUrl.set(true)">Add URL Now</button>
                            </div>
                        </div>
                    </div>
                } @else if (editingUrl()) {
                    <div class="url-edit-box animate-fadeIn">
                        <label class="text-[10px] uppercase font-bold text-muted mb-3 block tracking-widest">Live Website URL</label>
                        <div class="flex gap-3">
                            <input name="liveUrl" [(ngModel)]="newUrl" placeholder="https://example.com" class="form-input flex-1">
                            <button class="btn btn-primary btn-sm" (click)="updateUrl()">Save</button>
                            <button class="btn btn-outline btn-sm" (click)="editingUrl.set(false)">Cancel</button>
                        </div>
                    </div>
                }

                <div class="rank-form flex gap-3 mb-4">
                    <div class="flex-1">
                        <input name="rankKey" [(ngModel)]="rankKeyword" placeholder="Enter target keyword..." class="form-input w-full">
                    </div>
                    <button class="btn btn-primary" (click)="checkRank()" [disabled]="checkingRank() || !site()?.url">
                        {{ checkingRank() ? 'Checking...' : 'Check Rank' }}
                    </button>
                </div>

                <!-- Suggested Keywords to Check -->
                @if (pageReport.suggestedTags?.keywords) {
                    <div class="suggested-keywords mb-8 animate-fadeIn">
                        <p class="text-[10px] uppercase font-bold text-muted mb-3 tracking-wider">Suggested from Analysis:</p>
                        <div class="flex flex-wrap gap-2">
                            @for (kw of (pageReport.suggestedTags?.keywords || '').split(','); track kw) {
                                <button class="kw-chip" (click)="rankKeyword.set(kw.trim()); checkRank()">
                                    {{ kw.trim() }}
                                </button>
                            }
                        </div>
                    </div>
                }

                @if (rankResult()) {
                    <div class="rank-result-display grid grid-cols-2 gap-6 animate-fadeIn">
                    <div class="res-card">
                        <div class="flex justify-between items-start mb-2">
                            <div class="text-xs text-muted uppercase font-bold tracking-wider">Google Position</div>
                            @if (rankResult().isSimulated) {
                                <span class="text-[9px] bg-white/5 px-2 py-0.5 rounded border border-white/10 opacity-50">Simulation</span>
                            }
                        </div>
                        <div class="text-3xl font-black" [class.text-success]="rankResult().position <= 10">
                            #{{ rankResult().position }}
                        </div>
                    </div>
                    <div class="res-card">
                        <div class="text-xs text-muted uppercase font-bold tracking-wider mb-2">Trend</div>
                        <div class="flex items-center gap-3">
                            <span class="text-3xl">{{ rankResult().trend === 'up' ? 'üìà' : '‚ûñ' }}</span>
                            <span class="capitalize font-bold text-xl">{{ rankResult().trend }}</span>
                        </div>
                    </div>
                </div>
                }

                @if (rankResult() && !roadmap()) {
                    <div class="roadmap-cta animate-fadeIn">
                        <div>
                            <h4 class="font-bold text-lg">Want to reach #1?</h4>
                            <p class="text-sm opacity-70">AI can generate a custom 30-90 day strategic roadmap for this keyword.</p>
                        </div>
                        <button class="btn btn-primary" (click)="generateRoadmap()" [disabled]="generatingRoadmap()">
                            {{ generatingRoadmap() ? 'Strategizing...' : 'üöÄ Generate Roadmap' }}
                        </button>
                    </div>
                }

                @if (roadmap()) {
                    <div class="roadmap-display animate-fadeIn">
                        <div class="flex justify-between items-start mb-8">
                            <div>
                                <h4 class="text-2xl font-black uppercase tracking-tighter text-primary">Target: #1 Position</h4>
                                <p class="text-sm text-muted">Estimated Completion: <span class="text-white font-bold">{{ roadmap().estimatedTimeframe }}</span></p>
                            </div>
                            <div class="badge badge-outline">Strategic Plan</div>
                        </div>

                        <div class="roadmap-timeline">
                            @for (m of roadmap().milestones; track m.phase) {
                                <div class="timeline-step">
                                    <div class="step-dot"></div>
                                    <div class="flex justify-between items-center mb-3">
                                        <div class="font-bold text-secondary text-lg">{{ m.phase }}</div>
                                        <div class="text-[10px] uppercase font-bold px-3 py-1 rounded-full bg-white/10 border border-white/5"
                                             [class.text-success]="m.impact === 'High' || m.impact === 'Very High'">
                                            {{ m.impact }} Impact
                                        </div>
                                    </div>
                                    <ul class="task-list list-disc list-inside">
                                        @for (task of m.tasks; track task) {
                                            <li class="mb-2">{{ task }}</li>
                                        }
                                    </ul>
                                </div>
                            }
                        </div>

                        <div class="advice-box">
                            <label class="text-[10px] uppercase font-bold text-muted mb-2 block tracking-widest">AI Strategic Advice</label>
                            <p class="text-base italic opacity-90 leading-relaxed">"{{ roadmap().strategicAdvice }}"</p>
                        </div>
                        
                        <button class="btn btn-link btn-xs mt-6 text-primary-light" (click)="roadmap.set(null)">üîÑ Regenerate Strategy</button>
                    </div>
                }
            </div>

            <!-- OG Tag Master Section -->
            <div class="og-tag-master-card glass-card mt-6">
                <div class="flex justify-between items-center mb-6">
                    <div class="flex items-center gap-2">
                        <h3 class="text-xl font-bold">OG-Tag Master</h3>
                        <span class="badge badge-ai">Social Optimization</span>
                    </div>
                    @if (!socialTags()) {
                        <button class="btn btn-primary btn-sm px-6" (click)='generateSocialTags()' [disabled]="generatingSocial()">
                            {{ generatingSocial() ? 'Generating...' : '‚ú® Optimize Social Tags' }}
                        </button>
                    }
                </div>

                @if (socialTags()) {
                    <div class="social-preview-container bg-black/40 rounded-2xl border border-white/10 p-6 animate-fadeIn">
                        <div class="flex gap-2 mb-6">
                            <button class="social-tab" [class.active]="socialPreviewMode() === 'facebook'" 
                                (click)="socialPreviewMode.set('facebook')">Facebook</button>
                            <button class="social-tab" [class.active]="socialPreviewMode() === 'twitter'" 
                                (click)="socialPreviewMode.set('twitter')">Twitter / X</button>
                        </div>

                        <!-- Facebook Preview -->
                        @if (socialPreviewMode() === 'facebook') {
                            <div class="fb-preview animate-fadeIn rounded-xl overflow-hidden border border-white/10">
                                <div class="fb-image-placeholder relative h-48 bg-white/5 flex items-center justify-center p-8 text-center">
                                    <div class="absolute inset-0 opacity-20 bg-gradient-to-br from-primary to-secondary"></div>
                                    <span class="text-xs font-bold uppercase tracking-widest text-white/40 z-10">{{ socialTags().suggestedImage }}</span>
                                </div>
                                <div class="p-4 bg-[#f0f2f5] text-[#1c1e21]">
                                    <div class="text-[12px] uppercase opacity-60 font-semibold mb-1">{{ site()?.url || 'YOURSITE.COM' }}</div>
                                    <div class="font-bold text-[16px] leading-tight mb-1 text-[#1c1e21]">{{ socialTags().ogTitle }}</div>
                                    <div class="text-[14px] opacity-70 line-clamp-2 text-[#65676b]">{{ socialTags().ogDescription }}</div>
                                </div>
                            </div>
                        }

                        <!-- Twitter Preview -->
                        @if (socialPreviewMode() === 'twitter') {
                            <div class="twitter-preview animate-fadeIn rounded-xl overflow-hidden border border-white/20">
                                <div class="tw-image-placeholder relative h-48 bg-white/5 flex items-center justify-center p-8 text-center">
                                    <div class="absolute inset-0 opacity-10 bg-primary"></div>
                                    <span class="text-xs font-bold uppercase tracking-widest text-white/30 z-10">{{ socialTags().suggestedImage }}</span>
                                </div>
                                <div class="p-3 bg-black text-white border-t border-white/20">
                                    <div class="text-[13px] opacity-60 mb-1">{{ site()?.url || 'yoursite.com' }}</div>
                                    <div class="font-bold text-[15px] leading-tight mb-1 text-white">{{ socialTags().twitterTitle }}</div>
                                    <div class="text-[14px] opacity-70 line-clamp-2 text-white/80">{{ socialTags().twitterDescription }}</div>
                                </div>
                            </div>
                        }

                        <div class="mt-8 flex flex-col md:flex-row justify-between items-center bg-white/5 p-4 rounded-xl border border-white/5 gap-4">
                            <div class="flex-1">
                                <div class="text-[10px] uppercase font-bold text-muted mb-1 tracking-widest">AI Image Strategy</div>
                                <p class="text-xs italic opacity-80 leading-relaxed">{{ socialTags().suggestedImage }}</p>
                            </div>
                            <div class="flex gap-2">
                                <button class="btn btn-outline btn-sm px-4" (click)="generateSocialTags()">üîÑ Refresh</button>
                                <button class="btn btn-primary btn-sm px-6" (click)="applySocialTags()" [disabled]="patching()">Apply Tags</button>
                            </div>
                        </div>
                    </div>
                } @else {
                    <div class="text-center py-16 bg-white/2 rounded-2xl border border-dashed border-white/10">
                        <div class="text-5xl mb-4 group-hover:scale-110 transition-transform">üì¢</div>
                        <h4 class="text-lg font-bold mb-2">Social Sharing Data Missing</h4>
                        <p class="text-sm opacity-50 max-w-md mx-auto">Click generate to let AI craft high-converting titles and descriptions for your social media thumbnails.</p>
                    </div>
                }
            </div>

            <!-- Manual Experiment -->
            <div class="manual-eval-card glass-card mt-6">
                <div class="flex justify-between items-center mb-4">
                    <h3>Manual Meta Experiment</h3>
                    <span class="badge badge-ai">Real-time Check</span>
                </div>
                <div class="form-grid">
                    <div class="form-group mb-4">
                        <label class="block text-sm mb-1 text-muted">Custom Title</label>
                        <input name="testTitle" [(ngModel)]="manualTitle" placeholder="Enter test title..." class="form-input w-full">
                    </div>
                    <div class="form-group mb-4">
                        <label class="block text-sm mb-1 text-muted">Custom Description</label>
                        <textarea name="testDesc" [(ngModel)]="manualDescription" placeholder="Enter test description..." class="form-input w-full" rows="3"></textarea>
                    </div>
                    <button class="btn btn-primary w-full" (click)="evaluateManualTags()" [disabled]="evaluating()">
                        {{ evaluating() ? 'Analyzing...' : 'üîç Validate with AI' }}
                    </button>
                </div>

                @if (evaluationResult()) {
                    <div class="evaluation-feedback mt-6 p-4 rounded-lg" [class.success]="evaluationResult().isWorthDoing" [class.warning]="!evaluationResult().isWorthDoing">
                        <div class="flex justify-between items-center mb-4">
                            <span class="verdict-text">AI Verdict: {{ evaluationResult().isWorthDoing ? 'Worth Doing ‚úÖ' : 'Needs Improvement ‚ö†Ô∏è' }}</span>
                            <span class="badge">{{ evaluationResult().score }}% Strength</span>
                        </div>
                        <ul class="feedback-list">
                            @for (tip of evaluationResult().feedback; track tip) {
                                <li>{{ tip }}</li>
                            }
                        </ul>
                    </div>
                }
            </div>
        </div>
      }
    </div>
  <!-- Luxury Dashboard Report Section (Matches User Image) -->
  <div class="print-only-report dashboard-report">
    <!-- Page 1: Dashboard Overview -->
    <div class="report-page">
        <header class="report-header">
            <div class="logo-area">
                <span class="logo-text">your <span class="logo-blue">LOGO</span></span>
            </div>
            <div class="header-titles">
                <h1 class="top-title">SEO Dashboard</h1>
                <p class="top-date">{{ siteReport()!.timestamp | date:'MMMM yyyy' }}</p>
            </div>
        </header>

        <h1 class="main-report-tag">SEO Report</h1>

        <!-- Top Grid: Visibility & Meta -->
        <div class="dashboard-top-grid">
            <div class="dash-card rankings-chart">
                <div class="card-header">
                    <span class="icon">üìä</span> Google Rankings
                </div>
                <div class="mock-chart">
                    <div class="bar-group">
                        <div class="bar color-1" style="height: 60%"></div>
                        <div class="bar color-2" style="height: 40%"></div>
                        <div class="bar color-3" style="height: 30%"></div>
                    </div>
                    <div class="bar-group">
                        <div class="bar color-1" style="height: 50%"></div>
                        <div class="bar color-2" style="height: 45%"></div>
                        <div class="bar color-3" style="height: 20%"></div>
                    </div>
                    <div class="bar-group">
                        <div class="bar color-1" style="height: 70%"></div>
                        <div class="bar color-2" style="height: 30%"></div>
                        <div class="bar color-3" style="height: 40%"></div>
                    </div>
                </div>
            </div>

            <div class="dash-mini-cards">
                <div class="dash-card mini">
                    <span class="mini-label">Score Change</span>
                    <div class="mini-value success">
                        <span class="arrow">‚ñ≤</span> {{ (siteReport()!.overallScore - (site()?.previousScore || 0)) }}
                    </div>
                </div>
                <div class="dash-card mini">
                    <span class="mini-label">Technical Health</span>
                    <div class="mini-value">{{ siteReport()!.overallScore }}</div>
                </div>
                <div class="dash-card mini">
                    <span class="mini-label">Pages Scanned</span>
                    <div class="mini-value">{{ siteReport()!.pages.length }}</div>
                </div>
                <div class="dash-card mini">
                    <span class="mini-label">Broken Links</span>
                    <div class="mini-value danger">{{ siteReport()!.pages[0].brokenLinks?.length || 0 }}</div>
                </div>
            </div>

            <div class="dash-card visibility-card">
                <div class="card-header">
                    <span class="icon">üî•</span> Visibility
                </div>
                <div class="visibility-value">{{ siteReport()!.overallScore }}%</div>
            </div>
        </div>

        <!-- Middle Grid: Circular Scores -->
        <div class="dashboard-scores-grid">
            <div class="dash-card circle-score">
                <p class="score-name">Performance Score</p>
                <div class="ring-container">
                    <svg viewBox="0 0 36 36" class="circular-chart yellow">
                        <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                        <path class="circle" [attr.stroke-dasharray]="siteReport()!.pages[0].scores.structure + ', 100'" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                        <text x="18" y="20.35" class="percentage">{{ siteReport()!.pages[0].scores.structure }}</text>
                    </svg>
                </div>
            </div>
            <div class="dash-card circle-score">
                <p class="score-name">Accessibility Score</p>
                <div class="ring-container">
                    <svg viewBox="0 0 36 36" class="circular-chart yellow">
                        <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                        <path class="circle" [attr.stroke-dasharray]="siteReport()!.pages[0].scores.accessibility + ', 100'" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                        <text x="18" y="20.35" class="percentage">{{ siteReport()!.pages[0].scores.accessibility }}</text>
                    </svg>
                </div>
            </div>
            <div class="dash-card circle-score">
                <p class="score-name">Best Practices Score</p>
                <div class="ring-container">
                    <svg viewBox="0 0 36 36" class="circular-chart blue">
                        <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                        <path class="circle" [attr.stroke-dasharray]="siteReport()!.pages[0].scores.bestPractices + ', 100'" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                        <text x="18" y="20.35" class="percentage">{{ siteReport()!.pages[0].scores.bestPractices }}</text>
                    </svg>
                </div>
            </div>
            <div class="dash-card circle-score">
                <p class="score-name">SEO Score</p>
                <div class="ring-container">
                    <svg viewBox="0 0 36 36" class="circular-chart red">
                        <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                        <path class="circle" [attr.stroke-dasharray]="siteReport()!.overallScore + ', 100'" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                        <text x="18" y="20.35" class="percentage">{{ siteReport()!.overallScore }}</text>
                    </svg>
                </div>
            </div>
        </div>

        <!-- Keyword/Page Table -->
        <div class="dashboard-table-card dash-card">
            <div class="table-info">Showing {{ siteReport()!.pages.length }} of {{ siteReport()!.pages.length }} Pages</div>
            <table class="dash-table">
                <thead>
                    <tr>
                        <th width="40%">PAGE URL</th>
                        <th width="15%">SCORE</th>
                        <th width="15%">READABILITY</th>
                        <th width="15%">ISSUES</th>
                        <th width="15%">CHANGE</th>
                    </tr>
                </thead>
                <tbody>
                    @for (page of siteReport()!.pages; track page.url) {
                        <tr>
                            <td><strong>{{ page.url }}</strong></td>
                            <td>{{ page.overallScore }}%</td>
                            <td>{{ page.readabilityScore }}%</td>
                            <td>{{ page.recommendations.length }}</td>
                            <td class="success">‚ñ≤ {{ (page.overallScore - (site()?.previousScore || 0)) }}</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>

    <!-- Page 2+: AI Transformation Blueprint (Added for Full Detail) -->
    @for (page of siteReport()!.pages; track page.url) {
        <div class="report-page">
            <h2 class="section-heading">Optimization Details: {{ page.url }}</h2>
            <div class="optimization-blueprint">
                <div class="blueprint-item">
                    <h4>Identified Issues</h4>
                    <ul class="blueprint-list">
                        @for (rec of page.recommendations; track rec) {
                            <li>{{ rec }}</li>
                        }
                    </ul>
                </div>
                <div class="blueprint-item">
                    <h4>Meta Patch Blueprint</h4>
                    <table class="blueprint-table">
                        <tr>
                            <td><strong>Title</strong></td>
                            <td><span class="old">{{ page.data.title || 'Empty' }}</span> ‚Üí <span class="new">{{ page.suggestedTags?.title }}</span></td>
                        </tr>
                        <tr>
                            <td><strong>Description</strong></td>
                            <td><span class="old">{{ page.data.description || 'Empty' }}</span> ‚Üí <span class="new">{{ page.suggestedTags?.description }}</span></td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    }
  </div>
  }
</div>
